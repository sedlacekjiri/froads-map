<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GoCar — Fuel Return Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b0c; --card:#111214; --muted:#9aa0a6; --text:#e7e9ea;
      --accent:#facc15; --line:#232428; --good:#22c55e; --warn:#f97316; --bad:#ef4444;
      --chip:#1a1b1f;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,#0b0b0c 0%, #101114 100%); color:var(--text);
    }
    header{position:sticky; top:0; z-index:5; background:#111; border-bottom:1px solid #18191d;}
    .bar{max-width:1100px; margin:0 auto; padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px;}
    .logo{display:flex; align-items:center; gap:10px; color:#fff; text-decoration:none; font-weight:700; letter-spacing:.5px;}
    .logo-mark{width:28px; height:28px; border-radius:6px; background:var(--accent); display:grid; place-items:center; color:#111; font-weight:800;}
    .tagline{color:#cbd5e1; font-size:12px}
    main{max-width:1100px; margin:24px auto; padding:0 16px;}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:18px;}
    @media (max-width:900px){ .grid{grid-template-columns:1fr;} }
    .card{background:var(--card); border:1px solid var(--line); border-radius:14px; overflow:hidden;}
    .card h2{margin:0; padding:16px 18px; border-bottom:1px solid var(--line); font-size:18px; display:flex; align-items:center; justify-content:space-between;}
    .card .body{padding:16px 18px;}
    .field{display:grid; gap:8px; margin-bottom:14px;}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    select, input[type="number"] {
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #2a2c31;
  background:#141519;
  color:var(--text);   /* ✅ dříve tam bylo color:#var(--text); což byla chyba */
  outline:none;
}
    select:focus, input:focus{ border-color:#3b82f6; }
    .chips{display:flex; gap:8px; flex-wrap:wrap;}
    .chip{background:#1a1b1f; border:1px solid #2a2c31; color:#d1d5db; padding:6px 10px; border-radius:999px; font-size:12px;}
    .muted{color:var(--muted); font-size:12px;}
    .mono{font-variant-numeric:tabular-nums; font-feature-settings:"tnum" 1;}

    /* slider */
    .slider-row{display:grid; grid-template-columns:1fr 90px; gap:10px; align-items:center;}
    input[type="range"]{-webkit-appearance:none; appearance:none; width:100%; height:6px; border-radius:999px; background:linear-gradient(90deg,#22c55e 0%,#ef4444 100%);}
    input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%; background:#fff; border:2px solid #111; cursor:pointer; box-shadow:0 1px 0 rgba(0,0,0,.4);}
    input[type="range"]::-moz-range-thumb{width:18px; height:18px; border-radius:50%; background:#fff; border:2px solid #111; cursor:pointer;}

    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 14px; border-radius:10px; border:1px solid #2a2c31; background:#141519; color:#e5e7eb; cursor:pointer; text-decoration:none; font-weight:600;}
    .btn:hover{filter:brightness(1.06);}
    .btn.ghost{background:transparent; border-color:#2a2c31;}

    .results{display:grid; gap:8px; margin:10px 0 0;}
    .res{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border:1px dashed #2a2c31; border-radius:10px; background:#121317;}
    .res strong{font-size:15px;}
    .res .val{font-weight:700;}
    .total{margin-top:12px; padding:14px; border-radius:12px; background:#151821; border:1px solid #263045; display:flex; align-items:center; justify-content:space-between;}
    .total .sum{font-size:20px; font-weight:800;}
    .badges{display:flex; gap:8px; flex-wrap:wrap;}
    .badge{background:#121317; border:1px solid #2a2c31; border-radius:8px; padding:6px 8px; font-size:11px; color:#cbd5e1;}
    .hint{display:flex; gap:8px; align-items:center; color:#cbd5e1; font-size:12px;}
    .dot{width:8px; height:8px; border-radius:50%; background:var(--accent);}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <a class="logo" href="#"><span class="logo-mark">⛽</span><span>GoCar — Fuel Return Calculator</span></a>
      <span class="tagline">Return full. If not, we’ll refill and charge fairly.</span>
    </div>
  </header>

  <main class="grid">
    <!-- LEFT -->
    <section class="card">
      <h2>
        Vehicle & Fuel
        <span class="chips">
          <span id="chipFuel" class="chip">Fuel: —</span>
          <span id="chipCap" class="chip">Tank: — L</span>
        </span>
      </h2>
      <div class="body">
        <div class="field">
          <label for="vehicle">Vehicle model</label>
          <select id="vehicle" aria-label="Vehicle model"></select>
          <div class="badges" id="vehBadges"></div>
        </div>

        <!-- ADDED: Type + Currency toggles (UI only přidané, nic nepřepisuje) -->
        <div class="row" style="gap:16px">
          <div class="field" style="flex:1 1 220px; min-width:220px">
            <label>Vehicle type</label>
            <div class="row">
              <button class="btn ghost" id="typeCars" type="button" aria-pressed="true">Cars</button>
              <button class="btn ghost" id="typeCampers" type="button" aria-pressed="false">Campervans</button>
            </div>
            <div class="muted">Switch list between Go Cars & Go Campers.</div>
          </div>

          <div class="field" style="flex:1 1 220px; min-width:220px">
            <label>Currency</label>
            <div class="row">
              <button class="btn ghost" id="curEUR" type="button" aria-pressed="true">EUR</button>
              <button class="btn ghost" id="curISK" type="button" aria-pressed="false">ISK</button>
            </div>
            <div class="muted">Converts price/L, fee and totals.</div>
          </div>
        </div>
        <!-- /ADDED -->

        <div class="row" style="gap:16px">
          <div class="field" style="flex:1 1 240px; min-width:240px">
            <label for="pricePerL">Fuel price per liter (<span id="fuelTypeLbl">—</span>)</label>
            <div class="row">
              <input id="pricePerL" type="number" inputmode="decimal" step="0.01" min="0" value="2.10" style="flex:1" />
              <span class="btn ghost" id="reloadPrices" title="Fetch Iceland live prices">↻ Live</span>
            </div>
            <div class="hint"><span class="dot"></span><span id="priceSource">Using defaults (editable).</span></div>
          </div>

          <div class="field" style="flex:1 1 200px; min-width:200px">
            <label>Refuel service fee</label>
            <div class="btn" id="feeFixedLabel" style="pointer-events:none; opacity:.9">Fixed: €30</div>
            <div class="muted">Applied whenever tank is not full on return.</div>
          </div>
        </div>

        <hr style="border:0;border-top:1px solid var(--line); margin:14px 0">

        <div class="field">
          <label for="percentNow">Current fuel level (%)</label>
          <div class="slider-row">
            <input id="percentNow" type="range" min="0" max="100" step="1" value="100" />
            <input id="percentNowNum" type="number" min="0" max="100" step="1" value="100" />
          </div>
          <div class="row">
            <button class="btn ghost" data-q="25" type="button">25%</button>
            <button class="btn ghost" data-q="50" type="button">50%</button>
            <button class="btn ghost" data-q="75" type="button">75%</button>
            <button class="btn ghost" data-q="100" type="button">Full (100%)</button>
          </div>
          <div class="muted">All amounts shown on the right update automatically.</div>
        </div>
      </div>
    </section>

    <!-- RIGHT -->
    <section class="card">
      <h2>Estimate</h2>
      <div class="body">
        <div class="results">
          <div class="res">
            <div>
              <div class="muted">Vehicle</div>
              <strong id="outVeh">—</strong>
            </div>
            <div class="val" id="outFuel">—</div>
          </div>

          <div class="res">
            <div>
              <div class="muted">Missing to full</div>
              <strong><span id="outPct">0</span>%</strong>
            </div>
            <div class="val mono"><span id="outLiters">0.0</span> L</div>
          </div>

          <div class="res">
            <div>
              <div class="muted">Fuel cost</div>
              <strong class="mono" id="pricePerLLabel">€ <span id="outPricePerL">—</span> / L</strong>
            </div>
            <div class="val mono" id="outFuelCost">—</div>
          </div>

          <div class="res">
            <div>
              <div class="muted">Service fee</div>
              <strong class="mono" id="feeLabelStatic">€ 30</strong>
            </div>
            <div class="val mono" id="outServiceFeeVal">€ 0</div>
          </div>
        </div>

        <div class="total">
          <div>
            <div class="muted">Total to charge</div>
            <div class="sum mono" id="outTotal">€ 0</div>
          </div>
          <div class="muted" id="policy">Return full to avoid fuel + €30 fee.</div>
        </div>
      </div>
    </section>
  </main>

  <footer style="max-width:1100px; margin:24px auto; padding:0 16px 40px; color:#a1a1aa; font-size:12px;">
    <div>Notes</div>
    <ul>
      <li>If the fuel level is <strong>100%</strong>, the charge is <strong>€0</strong>.</li>
      <li>“Live” tries to fetch Iceland station prices (ISK/L) + ISK→EUR and fills current fuel price.</li>
      <li>If live fetch fails, you can edit the price manually (fallback is a recent EU-level estimate).</li>
    </ul>
  </footer>

  <script>
    // ===== Data =====
    const VEHICLES = [
      { id:'duster', name:'Dacia Duster', fuel:'Diesel', tankL:50, notes:['Compact SUV','4×4'] },
      { id:'jimny',  name:'Suzuki Jimny', fuel:'Petrol', tankL:40, notes:['Small 4×4'] },
      { id:'hilux',  name:'Toyota Hilux', fuel:'Diesel', tankL:80, notes:['Pickup','4×4'] },
      { id:'lc150',  name:'Toyota Land Cruiser 150', fuel:'Diesel', tankL:87, notes:['Large 4×4'] },
      { id:'rav4',   name:'Toyota RAV4', fuel:'Petrol', tankL:55, notes:['SUV'] },
      { id:'t6',     name:'VW Transporter 4×4', fuel:'Diesel', tankL:70, notes:['Van','4×4'] }
    ];

    // ADDED: Rich static sets (Cars + Campervans) — aproximované tanky + poznámky
    const CARS = [
      { id:'yaris',   name:'Toyota Yaris', fuel:'Petrol', tankL:42, notes:['Compact'] },
      { id:'corolla', name:'Toyota Corolla', fuel:'Petrol', tankL:47, notes:['Compact'] },
      { id:'i10',     name:'Hyundai i10', fuel:'Petrol', tankL:36, notes:['Mini'] },
      { id:'qashqai', name:'Nissan Qashqai', fuel:'Petrol', tankL:55, notes:['SUV'] },
      { id:'sportage',name:'Kia Sportage', fuel:'Diesel', tankL:54, notes:['SUV'] },
      { id:'rav4p',   name:'Toyota RAV4', fuel:'Petrol', tankL:55, notes:['SUV'] },
      { id:'duster2', name:'Dacia Duster', fuel:'Diesel', tankL:50, notes:['4×4'] },
      { id:'jimny2',  name:'Suzuki Jimny', fuel:'Petrol', tankL:40, notes:['Small 4×4'] },
      { id:'hilux2',  name:'Toyota Hilux', fuel:'Diesel', tankL:80, notes:['Pickup','4×4'] },
      { id:'lc150b',  name:'Toyota Land Cruiser 150', fuel:'Diesel', tankL:87, notes:['Large 4×4'] },
      { id:'trans',   name:'VW Transporter 4×4', fuel:'Diesel', tankL:70, notes:['Van','4×4'] }
    ];

    const CAMPERS = [
      { id:'go-smart-2', name:'Go SMART Camper (2-pax)', fuel:'Diesel', tankL:50, notes:['Campervan'] },
      { id:'go-smart-a', name:'Go SMART Automatic Camper', fuel:'Diesel', tankL:50, notes:['Campervan','Auto'] },
      { id:'go-lite-3',  name:'Go LITE Camper (3-pax)', fuel:'Diesel', tankL:60, notes:['Campervan'] },
      { id:'go-big-5',   name:'Go BIG Camper (5-pax)', fuel:'Diesel', tankL:70, notes:['Campervan'] },
      { id:'go-big-a',   name:'Go BIG Automatic Camper', fuel:'Diesel', tankL:70, notes:['Campervan','Auto'] },
      { id:'go-4x4-2',   name:'Go 4×4 Camper (2-pax)', fuel:'Diesel', tankL:80, notes:['4×4','Camper'] },
      { id:'go-4x4-4',   name:'Go 4×4 Camper (4-pax)', fuel:'Diesel', tankL:80, notes:['4×4','Camper'] }
    ];
    // /ADDED

    // Fallback (EUR/L) if live fetch fails (rounded, conservative)
    const FALLBACK_EUR = { Petrol: 2.09, Diesel: 2.23 };

    // Intl formatters
    const EUR = new Intl.NumberFormat('en-IE', { style:'currency', currency:'EUR', maximumFractionDigits:2 });
    // ADDED: ISK formatter
    const ISK = new Intl.NumberFormat('is-IS', { style:'currency', currency:'ISK', maximumFractionDigits:0 });

    // ===== DOM =====
    const selVeh = document.getElementById('vehicle');
    const chipFuel = document.getElementById('chipFuel');
    const chipCap  = document.getElementById('chipCap');
    const vehBadges= document.getElementById('vehBadges');

    const fuelTypeLbl = document.getElementById('fuelTypeLbl');
    const pricePerL = document.getElementById('pricePerL');
    const reloadBtn = document.getElementById('reloadPrices');
    const priceSource = document.getElementById('priceSource');

    const percentNow = document.getElementById('percentNow');
    const percentNowNum = document.getElementById('percentNowNum');

    const outVeh = document.getElementById('outVeh');
    const outFuel= document.getElementById('outFuel');
    const outPct = document.getElementById('outPct');
    const outLiters = document.getElementById('outLiters');
    const outPricePerL = document.getElementById('outPricePerL');
    const outFuelCost = document.getElementById('outFuelCost');
    const outServiceFeeVal = document.getElementById('outServiceFeeVal');
    const outTotal = document.getElementById('outTotal');

    // ADDED: extra labels to toggle currency symbols without měnit HTML strukturu
    const pricePerLLabel = document.getElementById('pricePerLLabel');
    const feeLabelStatic = document.getElementById('feeLabelStatic');
    const feeFixedLabel  = document.getElementById('feeFixedLabel');

    // ADDED: controls
    const typeCarsBtn    = document.getElementById('typeCars');
    const typeCampersBtn = document.getElementById('typeCampers');
    const curEURBtn      = document.getElementById('curEUR');
    const curISKBtn      = document.getElementById('curISK');

    // ADDED: State pro toggly + kurz
    let VEH_TYPE = 'cars';     // 'cars' | 'campers'
    let CURRENCY = 'EUR';      // 'EUR'  | 'ISK'
    let _ISK_PER_EUR = 150;    // default; upřesní se po Live fetch
    let _pricePerLEUR = null;  // interní baseline (EUR/L) – z Live nebo z inputu

    // ===== Populate vehicles =====
    function populateVehicles(){
      selVeh.innerHTML = '';
      VEHICLES.forEach(v=>{
        const opt = document.createElement('option');
        opt.value = v.id; opt.textContent = v.name;
        selVeh.appendChild(opt);
      });
      selVeh.value = 'duster';
      onVehicleChange();
    }
    function getVehicle(){ return [...selVeh.options].length ? (CURRENT_LIST().find(v => v.id === selVeh.value) || CURRENT_LIST()[0]) : VEHICLES[0]; }

    // ADDED: aktivní seznam dle přepínače
    function CURRENT_LIST(){ return VEH_TYPE === 'cars' ? CARS : CAMPERS; }
    function repopulateWith(list){
      selVeh.innerHTML = '';
      list.forEach(v=>{
        const opt = document.createElement('option');
        opt.value = v.id; opt.textContent = v.name;
        selVeh.appendChild(opt);
      });
      if (list[0]) selVeh.value = list[0].id;
      onVehicleChange();
    }

    function onVehicleChange(){
      const v = getVehicle();
      chipFuel.textContent = `Fuel: ${v.fuel}`;
      chipCap.textContent  = `Tank: ${v.tankL} L`;
      fuelTypeLbl.textContent = v.fuel;
      vehBadges.innerHTML = '';
      (v.notes||[]).forEach(n=>{
        const b = document.createElement('span'); b.className='badge'; b.textContent=n; vehBadges.appendChild(b);
      });
      // pokud je prázdné/<=0, nastav implied default dle typu
      if ((Number(pricePerL.value)||0) <= 0 || _pricePerLEUR === null){
        const base = (v.fuel === 'Diesel') ? FALLBACK_EUR.Diesel : FALLBACK_EUR.Petrol;
        _pricePerLEUR = base; // ADDED: držet baseline v EUR
        syncDisplayedPriceFromBase();
      }
      calculate();
    }
    selVeh.addEventListener('change', onVehicleChange);

    // ===== Live fuel price fetch (Iceland) =====
    async function fetchIcelandFuelEUR(){
      const petrolRes = await fetch('https://apis.is/petrol', { cache:'no-store' });
      if(!petrolRes.ok) throw new Error('petrol fetch '+petrolRes.status);
      const stations = (await petrolRes.json()).results || [];

      const curRes = await fetch('https://apis.is/currency/m5', { cache:'no-store' });
      if(!curRes.ok) throw new Error('currency fetch '+curRes.status);
      const cur = (await curRes.json()).results || [];
      const eur = cur.find(x=>x.shortName==='EUR');
      const ISK_PER_EUR = eur && Number(eur.value);
      if(!ISK_PER_EUR) throw new Error('No EUR rate');

      const p95 = stations.map(s=>Number(s.bensin95)).filter(n=>isFinite(n) && n>0).sort((a,b)=>a-b);
      const dsl = stations.map(s=>Number(s.diesel)).filter(n=>isFinite(n) && n>0).sort((a,b)=>a-b);
      const median = arr => arr.length? (arr[Math.floor((arr.length-1)/2)] + arr[Math.ceil((arr.length-1)/2)]) / 2 : NaN;

      const p95ISK = median(p95);
      const dslISK = median(dsl);
      if(!isFinite(p95ISK) || !isFinite(dslISK)) throw new Error('No station prices');

      return {
        Petrol: +(p95ISK / ISK_PER_EUR).toFixed(3),
        Diesel: +(dslISK / ISK_PER_EUR).toFixed(3),
        meta: { ISK_PER_EUR, stations: stations.length }
      };
    }

    async function refreshLivePrice(){
      const fuel = getVehicle().fuel; // Diesel/Petrol
      try{
        priceSource.textContent = 'Loading Iceland live price…';
        reloadBtn.disabled = true; reloadBtn.style.opacity = .6;

        const live = await fetchIcelandFuelEUR();
        _ISK_PER_EUR = live.meta.ISK_PER_EUR; // ADDED: aktualizace kurzu
        _pricePerLEUR = (fuel === 'Diesel' ? live.Diesel : live.Petrol); // baseline EUR/L
        syncDisplayedPriceFromBase();
        priceSource.textContent = `Live from Iceland stations • median (${live.meta.stations} stations) • €1 = ${live.meta.ISK_PER_EUR.toFixed(2)} ISK`;
      }catch(e){
        console.warn('Live price failed:', e);
        // fallback – ponech baseline pokud není
        if (_pricePerLEUR == null){
          const v = getVehicle();
          _pricePerLEUR = (v.fuel === 'Diesel') ? FALLBACK_EUR.Diesel : FALLBACK_EUR.Petrol;
          syncDisplayedPriceFromBase();
        }
        priceSource.textContent = 'Using fallback estimate (editable).';
      }finally{
        reloadBtn.disabled = false; reloadBtn.style.opacity = 1;
        calculate();
      }
    }

    reloadBtn.addEventListener('click', refreshLivePrice);

    // ===== Percent sync & inputs =====
    function clampPct(n){ n = Number(n)||0; return Math.min(100, Math.max(0, Math.round(n))); }
    const syncAndCalc = ()=>{ percentNowNum.value = clampPct(percentNow.value); calculate(); };
    percentNow.addEventListener('input', syncAndCalc);
    percentNowNum.addEventListener('input', ()=>{ percentNowNum.value = clampPct(percentNowNum.value); percentNow.value = percentNowNum.value; calculate(); });
    document.querySelectorAll('[data-q]').forEach(btn=>{
      btn.addEventListener('click', ()=>{ const v = Number(btn.getAttribute('data-q')); percentNow.value=v; percentNowNum.value=v; calculate(); });
    });

    // ADDED: když user edituje cenu/l, přepočítej baseline dle zvolené měny
    pricePerL.addEventListener('input', ()=>{
      const val = Math.max(0, Number(pricePerL.value)||0);
      _pricePerLEUR = (CURRENCY === 'EUR') ? val : (val / _ISK_PER_EUR);
      calculate();
    });

    // ===== Calc =====
    const SERVICE_FEE_EUR = 30;
    function round(n,p=2){ const m = 10**p; return Math.round(n*m)/m; }
    function currencySymbol(){ return CURRENCY === 'EUR' ? '€' : 'ISK'; }
    function fmt(n){
      return CURRENCY === 'EUR' ? EUR.format(round(n,2)) : ISK.format(Math.round(n));
    }
    function currentPricePerL(){
      return CURRENCY === 'EUR' ? (_pricePerLEUR||0) : (_pricePerLEUR||0) * _ISK_PER_EUR;
    }
    function syncDisplayedPriceFromBase(){
      const disp = currentPricePerL();
      // vizuální input
      pricePerL.value = (CURRENCY === 'EUR') ? disp.toFixed(2) : Math.round(disp);
      // label "€ X / L"
      pricePerLLabel.innerHTML = `${currencySymbol()} <span id="outPricePerL">—</span> / L`;
      outPricePerL.textContent = (CURRENCY === 'EUR') ? (disp).toFixed(2) : Math.round(disp).toString();
      // statická fee tlačítka a label
      const feeDisp = (CURRENCY === 'EUR') ? SERVICE_FEE_EUR : Math.round(SERVICE_FEE_EUR * _ISK_PER_EUR);
      feeLabelStatic.textContent = `${currencySymbol()} ${feeDisp}`;
      feeFixedLabel.textContent  = `Fixed: ${currencySymbol()}${feeDisp}`;
      // policy text (ponechán v EUR, nebo můžeme přepsat měnu)
      document.getElementById('policy').textContent =
        `Return full to avoid fuel + ${currencySymbol()}${feeDisp} fee.`;
    }

    function calculate(){
      const v = getVehicle();
      const pct = clampPct(percentNowNum.value);
      const missingPct = 100 - pct;
      const litersNeeded = v.tankL * (missingPct/100);

      const price = Math.max(0, Number(pricePerL.value)||0); // již v aktivní měně
      const fuelCost = litersNeeded * price;

      const shouldChargeFee = missingPct > 0;
      const fee = (CURRENCY === 'EUR') ? SERVICE_FEE_EUR : Math.round(SERVICE_FEE_EUR * _ISK_PER_EUR);
      const total = fuelCost + (shouldChargeFee ? fee : 0);

      // Output
      document.getElementById('outVeh').textContent = v.name;
      document.getElementById('outFuel').textContent = v.fuel;
      outPct.textContent = missingPct.toString();
      outLiters.textContent = round(litersNeeded, 1).toFixed(1);

      // price/L label je nastavován v syncDisplayedPriceFromBase
      outFuelCost.textContent = fmt(fuelCost);
      outServiceFeeVal.textContent = shouldChargeFee ? fmt(fee) : fmt(0);
      outTotal.textContent = fmt(total);
    }

    // ADDED: toggle helpers (vizuální pressed stav)
    function setPressed(btnA, btnB, active){
      btnA.setAttribute('aria-pressed', String(active));
      btnB.setAttribute('aria-pressed', String(!active));
      if(active){ btnA.classList.remove('ghost'); btnB.classList.add('ghost'); }
      else{ btnB.classList.remove('ghost'); btnA.classList.add('ghost'); }
    }

    // ADDED: type events
    typeCarsBtn.addEventListener('click', ()=>{
      if (VEH_TYPE === 'cars') return;
      VEH_TYPE = 'cars';
      setPressed(typeCarsBtn, typeCampersBtn, true);
      repopulateWith(CARS);
    });
    typeCampersBtn.addEventListener('click', ()=>{
      if (VEH_TYPE === 'campers') return;
      VEH_TYPE = 'campers';
      setPressed(typeCampersBtn, typeCarsBtn, true);
      repopulateWith(CAMPERS);
    });

    // ADDED: currency events
    curEURBtn.addEventListener('click', ()=>{
      if (CURRENCY === 'EUR') return;
      CURRENCY = 'EUR';
      setPressed(curEURBtn, curISKBtn, true);
      syncDisplayedPriceFromBase();
      calculate();
    });
    curISKBtn.addEventListener('click', ()=>{
      if (CURRENCY === 'ISK') return;
      CURRENCY = 'ISK';
      setPressed(curISKBtn, curEURBtn, true);
      syncDisplayedPriceFromBase();
      calculate();
    });

    // ===== Init =====
    (function init(){
      // naplň vozidla (původní – nezměněno)
      populateVehicles();

      // ADDED: výchozí seznam bude "Cars" z rozšířených dat
      VEH_TYPE = 'cars';
      setPressed(typeCarsBtn, typeCampersBtn, true);
      repopulateWith(CARS);

      // výchozí cena podle typu (EUR) — držíme jako baseline
      const v = getVehicle();
      _pricePerLEUR = (v.fuel === 'Diesel') ? FALLBACK_EUR.Diesel : FALLBACK_EUR.Petrol;
      priceSource.textContent = 'Using defaults (editable).';
      syncDisplayedPriceFromBase();

      // auto-refresh live hned po načtení (upřesní EUR/L i kurz ISK↔EUR)
      refreshLivePrice();
      calculate();
    })();
  </script>
</body>
</html>
